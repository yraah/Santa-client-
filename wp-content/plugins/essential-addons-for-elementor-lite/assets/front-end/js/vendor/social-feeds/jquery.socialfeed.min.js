"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),function(g,t,e,s){g.fn.socialfeed=function(t){var l=g.extend({plugin_folder:"",template:"template.html",show_media:!1,media_min_width:300,length:500,date_format:"ll",date_locale:"en"},t),m=g(this),e=["facebook","instagram","vk","google","blogspot","twitter","pinterest","rss"],p=0,d=0;e.forEach(function(t){l[t]&&(l[t].accounts?p+=l[t].limit*l[t].accounts.length:l[t].urls?p+=l[t].limit*l[t].urls.length:p+=l[t].limit)});var c={request:function(t,e){g.ajax({url:t,dataType:"jsonp",success:e})},get_request:function(t,e){g.get(t,e,"json")},wrapLinks:function(t,e){return t="google-plus"===e?t.replace(/(@|#)([a-z0-9_]+['])/gi,c.wrapGoogleplusTagTemplate):t.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,c.wrapLinkTemplate)},wrapLinkTemplate:function(t){return'<a target="_blank" href="'+t+'">'+t+"</a>"},wrapGoogleplusTagTemplate:function(t){return'<a target="_blank" href="https://plus.google.com/s/'+t+'" >'+t+"</a>"},shorten:function(t){return(t=g.trim(t)).length>l.length?jQuery.trim(t).substring(0,l.length).split(" ").slice(0,-1).join(" ")+"...":t},stripHTML:function(t){return null==t?"":t.replace(/(<([^>]+)>)|nbsp;|\s{2,}|/gi,"")}};function r(t,e){this.content=e,this.content.social_network=t,this.content.attachment=this.content.attachment===s?"":this.content.attachment,this.content.time_ago=e.dt_create.locale(l.date_locale).fromNow(),this.content.date=e.dt_create.locale(l.date_locale).format(l.date_format),this.content.dt_create=this.content.dt_create.valueOf(),this.content.text=c.wrapLinks(c.shorten(e.message+" "+e.description),e.social_network),this.content.moderation_passed=!l.moderation||l.moderation(this.content),h[t].posts.push(this)}var h={template:!(r.prototype={render:function(){var t=h.template(this.content),e=this.content;if(0!==g(m).children("[social-feed-id="+e.id+"]").length)return!1;if(0===g(m).children().length)g(m).append(t);else{var a=0,i=-1;if(g.each(g(m).children(),function(){if(g(this).attr("dt-create")<e.dt_create)return i=a,!1;a++}),g(m).append(t),0<=i){i++;var s=g(m).children("div:nth-child("+i+")"),n=g(m).children("div:last-child");g(n).insertBefore(s)}}if(l.media_min_width){var r="[social-feed-id="+e.id+"] img.attachment",o=g(r),c=new Image,u=o.attr("src");g(c).on("load",function(){c.width<l.media_min_width&&o.hide(),delete c}).on("error",function(){o.hide()}).attr({src:u})}++d==p&&l.callback&&l.callback()}}),init:function(){h.getTemplate(function(){e.forEach(function(e){l[e]&&(l[e].accounts?l[e].accounts.forEach(function(t){h[e].getData(t)}):l[e].urls?l[e].urls.forEach(function(t){h[e].getData(t)}):h[e].getData())})})},getTemplate:function(e){return h.template?e():l.template_html?(h.template=doT.template(l.template_html),e()):void g.get(l.template,function(t){return h.template=doT.template(t),e()})},twitter:{posts:[],loaded:!1,api:"http://api.tweecool.com/",getData:function(t){var e=new Codebird;switch(e.setConsumerKey(l.twitter.consumer_key,l.twitter.consumer_secret),l.twitter.proxy!==s&&e.setProxy(l.twitter.proxy),t[0]){case"@":var a=t.substr(1);e.__call("statuses_userTimeline",{id:a,count:l.twitter.limit,tweet_mode:void 0===l.twitter.tweet_mode?"compatibility":l.twitter.tweet_mode},h.twitter.utility.getPosts,!0);break;case"#":var i=t.substr(1);e.__call("search_tweets",{q:i,count:l.twitter.limit,tweet_mode:void 0===l.twitter.tweet_mode?"compatibility":l.twitter.tweet_mode},function(t){h.twitter.utility.getPosts(t.statuses)},!0)}},utility:{getPosts:function(t){t&&g.each(t,function(){new r("twitter",h.twitter.utility.unifyPostData(this)).render()})},unifyPostData:function(t){var e={};if(t.id&&(e.id=t.id_str,e.dt_create=moment(t.created_at,"dd MMM DD HH:mm:ss ZZ YYYY"),e.author_link="http://twitter.com/"+t.user.screen_name,e.author_picture=t.user.profile_image_url_https,e.post_url=e.author_link+"/status/"+t.id_str,e.author_name=t.user.name,e.message=void 0===t.text?t.full_text.substr(t.display_text_range[0],t.display_text_range[1]):t.text,e.description="",e.link="http://twitter.com/"+t.user.screen_name+"/status/"+t.id_str,!0===l.show_media&&t.entities.media&&0<t.entities.media.length)){var a=t.entities.media[0].media_url_https;a&&(e.attachment='<img class="attachment" src="'+a+'" />')}return e}}},facebook:{posts:[],graph:"https://graph.facebook.com/",loaded:!1,getData:function(t){function e(t){c.request(t,h.facebook.utility.getPosts)}var a="?fields=id,from,name,message,created_time,story,description,link";a+=!0===l.show_media?",picture,object_id":"";var i,s="&limit="+l.facebook.limit,n="&access_token="+l.facebook.access_token+"&callback=?";switch(t[0]){case"@":var r=t.substr(1);h.facebook.utility.getUserId(r,function(t){""!==t.id&&(i=h.facebook.graph+"v2.12/"+t.id+"/posts"+a+s+n,e(i))});break;case"!":var o=t.substr(1);i=h.facebook.graph+"v2.12/"+o+"/feed"+a+s+n,e(i);break;default:e(i)}},utility:{getUserId:function(t,e){var a="https://graph.facebook.com/"+t+"?"+("&access_token="+l.facebook.access_token+"&callback=?");g.get(a,e,"json")},prepareAttachment:function(t){var e=t.picture;return-1!==e.indexOf("_b.")||(-1!==e.indexOf("safe_image.php")?e=h.facebook.utility.getExternalImageURL(e,"url"):-1!==e.indexOf("app_full_proxy.php")?e=h.facebook.utility.getExternalImageURL(e,"src"):t.object_id&&(e=h.facebook.graph+t.object_id+"/picture/?type=normal")),'<img class="attachment" src="'+e+'" />'},getExternalImageURL:function(t,e){return-1===(t=decodeURIComponent(t).split(e+"=")[1]).indexOf("fbcdn-sphotos")?t.split("&")[0]:t},getPosts:function(t){t.data&&t.data.forEach(function(t){new r("facebook",h.facebook.utility.unifyPostData(t)).render()})},unifyPostData:function(t){var e={},a=t.message?t.message:t.story;if(e.id=t.id,e.dt_create=moment(t.created_time),e.author_link="http://facebook.com/"+t.from.id,e.author_picture=h.facebook.graph+t.from.id+"/picture",e.author_name=t.from.name,e.name=t.name||"",e.message=a||"",e.description=t.description?t.description:"",e.link=t.link?t.link:"http://facebook.com/"+t.from.id,!0===l.show_media&&t.picture){var i=h.facebook.utility.prepareAttachment(t);i&&(e.attachment=i)}return e}}},google:{posts:[],loaded:!1,api:"https://www.googleapis.com/plus/v1/",getData:function(t){var e;switch(t[0]){case"#":var a=t.substr(1);e=h.google.api+"activities?query="+a+"&key="+l.google.access_token+"&maxResults="+l.google.limit,c.get_request(e,h.google.utility.getPosts);break;case"@":var i=t.substr(1);e=h.google.api+"people/"+i+"/activities/public?key="+l.google.access_token+"&maxResults="+l.google.limit,c.get_request(e,h.google.utility.getPosts)}},utility:{getPosts:function(e){e.items&&g.each(e.items,function(t){new r("google",h.google.utility.unifyPostData(e.items[t])).render()})},unifyPostData:function(t){var e={};return e.id=t.id,e.attachment="",e.description="",e.dt_create=moment(t.published),e.author_link=t.actor.url,e.author_picture=t.actor.image.url,e.author_name=t.actor.displayName,!0===l.show_media&&t.object.attachments&&g.each(t.object.attachments,function(){var t="";this.fullImage?t=this.fullImage.url:"album"===this.objectType&&this.thumbnails&&0<this.thumbnails.length&&this.thumbnails[0].image&&(t=this.thumbnails[0].image.url),e.attachment='<img class="attachment" src="'+t+'"/>'}),e.message=t.title,e.link=t.url,e}}},instagram:{posts:[],api:"https://api.instagram.com/v1/",loaded:!1,accessType:function(){return void 0===l.instagram.access_token&&void 0===l.instagram.client_id?(console.log("You need to define a client_id or access_token to authenticate with Instagram's API."),s):(l.instagram.access_token&&(l.instagram.client_id=s),l.instagram.access_type=void 0===l.instagram.client_id?"access_token":"client_id",l.instagram.access_type)},getData:function(t){var e;if("undefined"!==this.accessType())var a=l.instagram.access_type+"="+l.instagram[l.instagram.access_type];switch(t[0]){case"@":var i=t.substr(1);e=h.instagram.api+"users/search/?q="+i+"&"+a+"&count=1&callback=?",c.request(e,h.instagram.utility.getUsers);break;case"#":var s=t.substr(1);e=h.instagram.api+"tags/"+s+"/media/recent/?"+a+"&count="+l.instagram.limit+"&callback=?",c.request(e,h.instagram.utility.getImages);break;case"&":var n=t.substr(1);e=h.instagram.api+"users/"+n+"/?"+a+"&count="+l.instagram.limit+"&callback=?",c.request(e,h.instagram.utility.getUsers)}},utility:{getImages:function(t){t.data&&t.data.forEach(function(t){new r("instagram",h.instagram.utility.unifyPostData(t)).render()})},getUsers:function(t){if("undefined"!==l.instagram.access_type)var a=l.instagram.access_type+"="+l.instagram[l.instagram.access_type];jQuery.isArray(t.data)||(t.data=[t.data]),t.data.forEach(function(t){var e=h.instagram.api+"users/"+t.id+"/media/recent/?"+a+"&count="+l.instagram.limit+"&callback=?";c.request(e,h.instagram.utility.getImages)})},unifyPostData:function(t){var e={};return e.id=t.id,e.dt_create=moment(1e3*t.created_time),e.author_link="http://instagram.com/"+t.user.username,e.author_picture=t.user.profile_picture,e.author_name=t.user.full_name||t.user.username,e.message=t.caption&&t.caption?t.caption.text:"",e.description="",e.link=t.link,l.show_media&&(e.attachment='<img class="attachment" src="'+t.images.standard_resolution.url+'" />'),e}}},vk:{posts:[],loaded:!1,base:"http://vk.com/",api:"https://api.vk.com/method/",user_json_template:"https://api.vk.com/method/users.get?fields=first_name,%20last_name,%20screen_name,%20photo&uid=",group_json_template:"https://api.vk.com/method/groups.getById?fields=first_name,%20last_name,%20screen_name,%20photo&gid=",getData:function(t){var e;switch(t[0]){case"@":var a=t.substr(1);e=h.vk.api+"wall.get?owner_id="+a+"&filter="+l.vk.source+"&count="+l.vk.limit+"&callback=?",c.get_request(e,h.vk.utility.getPosts);break;case"#":var i=t.substr(1);e=h.vk.api+"newsfeed.search?q="+i+"&count="+l.vk.limit+"&callback=?",c.get_request(e,h.vk.utility.getPosts)}},utility:{getPosts:function(i){i.response&&g.each(i.response,function(){if(this!=parseInt(this)&&"post"===this.post_type){var t=this.owner_id?this.owner_id:this.from_id,e=0<t?h.vk.user_json_template+t+"&callback=?":h.vk.group_json_template+-1*t+"&callback=?",a=this;c.get_request(e,function(t){h.vk.utility.unifyPostData(t,a,i)})}})},unifyPostData:function(t,e,a){var i={};if(i.id=e.id,i.dt_create=moment.unix(e.date),i.description=" ",i.message=c.stripHTML(e.text),l.show_media&&e.attachment&&("link"===e.attachment.type&&(i.attachment='<img class="attachment" src="'+e.attachment.link.image_src+'" />'),"video"===e.attachment.type&&(i.attachment='<img class="attachment" src="'+e.attachment.video.image_big+'" />'),"photo"===e.attachment.type&&(i.attachment='<img class="attachment" src="'+e.attachment.photo.src_big+'" />')),0<e.from_id){var s=h.vk.user_json_template+e.from_id+"&callback=?";c.get_request(s,function(t){new r("vk",h.vk.utility.getUser(t,i,e,a)).render()})}else{var n=h.vk.group_json_template+-1*e.from_id+"&callback=?";c.get_request(n,function(t){new r("vk",h.vk.utility.getGroup(t,i,e,a)).render()})}},getUser:function(t,e,a,i){return e.author_name=t.response[0].first_name+" "+t.response[0].last_name,e.author_picture=t.response[0].photo,e.author_link=h.vk.base+t.response[0].screen_name,e.link=h.vk.base+t.response[0].screen_name+"?w=wall"+a.from_id+"_"+a.id,e},getGroup:function(t,e,a,i){return e.author_name=t.response[0].name,e.author_picture=t.response[0].photo,e.author_link=h.vk.base+t.response[0].screen_name,e.link=h.vk.base+t.response[0].screen_name+"?w=wall-"+t.response[0].gid+"_"+a.id,e}}},blogspot:{loaded:!1,getData:function(t){switch(t[0]){case"@":var e=t.substr(1);request("http://"+e+".blogspot.com/feeds/posts/default?alt=json-in-script&callback=?",getPosts)}},utility:{getPosts:function(t){g.each(t.feed.entry,function(){var t={},e=this;t.id=e.id.$t.replace(/[^a-z0-9]/gi,""),t.dt_create=moment(e.published.$t),t.author_link=e.author[0].uri.$t,t.author_picture="http:"+e.author[0].gd$image.src,t.author_name=e.author[0].name.$t,t.message=e.title.$t+"</br></br>"+stripHTML(e.content.$t),t.description="",t.link=e.link.pop().href,l.show_media&&e.media$thumbnail&&(t.attachment='<img class="attachment" src="'+e.media$thumbnail.url+'" />'),t.render()})}}},pinterest:{posts:[],loaded:!1,apiv1:"https://api.pinterest.com/v1/",getData:function(t){var e,a="limit="+l.pinterest.limit,i="fields=id,created_at,link,note,creator(url,first_name,last_name,image),image&access_token="+l.pinterest.access_token+"&"+a+"&callback=?";switch(t[0]){case"@":var s=t.substr(1);e="me"===s?h.pinterest.apiv1+"me/pins/?"+i:h.pinterest.apiv1+"boards/"+s+"/pins?"+i}c.request(e,h.pinterest.utility.getPosts)},utility:{getPosts:function(t){t.data.forEach(function(t){new r("pinterest",h.pinterest.utility.unifyPostData(t)).render()})},unifyPostData:function(t){var e={};return e.id=t.id,e.dt_create=moment(t.created_at),e.author_link=t.creator.url,e.author_picture=t.creator.image["60x60"].url,e.author_name=t.creator.first_name+t.creator.last_name,e.message=t.note,e.description="",e.social_network="pinterest",e.link=t.link?t.link:"https://www.pinterest.com/pin/"+t.id,l.show_media&&(e.attachment='<img class="attachment" src="'+t.image.original.url+'" />'),e}}},rss:{posts:[],loaded:!1,api:"https://query.yahooapis.com/v1/public/yql?q=",datatype:"json",getData:function(t){var e=l.rss.limit,a=encodeURIComponent("select entry FROM feednormalizer where url='"+t+"' AND output='atom_1.0' | truncate(count="+e+")"),i=h.rss.api+a+"&format=json&callback=?";c.request(i,h.rss.utility.getPosts,h.rss.datatype)},utility:{getPosts:function(t){console.log(t),0<t.query.count&&g.each(t.query.results.feed,function(t,e){new r("rss",h.rss.utility.unifyPostData(t,e)).render()})},unifyPostData:function(t,e){var a=e;e.entry!==s&&(a=e.entry);var i={};return i.id='"'+a.id+'"',i.dt_create=moment(a.published,"YYYY-MM-DDTHH:mm:ssZ","en"),i.author_link="",i.author_picture="",i.author_name="",a.creator!==s&&(i.author_name=a.creator),i.message=a.title,i.description="",a.summary!==s&&(i.description=c.stripHTML(a.summary.content)),i.social_network="rss",i.link=a.link.href,l.show_media&&a.thumbnail!==s&&(i.attachment='<img class="attachment" src="'+a.thumbnail.url+'" />'),i}}}};return this.each(function(){h.init(),l.update_period&&setInterval(function(){return h.init()},l.update_period)})}}(jQuery);